<div id="map-container">

</div>
<script src='build/scaled.js'></script>
<script>

// Main Instance of the Generator
var generator = new ScaledGen({
    debug : true,
    logs : ['tmxRender'],
    maxTries : 20
});

// Set the Map Size you want to Generate
generator.SetMapSize(17,17);


// Add Terrains that meet your needs
generator.AddTerrain({
	key : 'layer_water',
	label : 'Water',
	max : 30,
	min : 0,
	default : true
});

generator.AddTerrain({
	key : 'layer_plain',
	label : 'Plain',
	max : 65,
	min : 30
});

generator.AddTerrain({
	key : 'layer_trees',
	label : 'Trees',
	max : 65,
	min : 30,
	type : "decoration"
});

generator.AddTerrain({
	key : 'layer_snow',
	label : 'Snow',
	max : 100,
	min : 30
});


// Define How the Map will look by specifying the 
// Starting Condition of the map
generator.AddStartingCondition({
	terrainKey: 'layer_water', 
	minCount: 1,
	optionalPercent: 25
});

generator.AddStartingCondition({
	terrainKey: 'layer_plain', 
	minCount: 1,
	optionalPercent: 35
});

generator.AddStartingCondition({
	terrainKey: 'layer_snow', 
	minCount: 1,
	optionalPercent: 20
});


// Define Validation Rules
// So that the Generator will only generate a Map that
// meets the Rules you have given
generator.AddValidationRule({
	terrainKey : 'layer_water',
	minPercent : 5
});


// If you are generating Full TMX Map. Provide the GID Values (Explained Below)
// for each Layer. Default Layers Need only one Data Provided the Full Tile image.
generator.AddGidInfo({
	terrainKey : 'layer_water',
	gidData : {
		other: {
			full: 3
		}
	}	
});

// This is how a regular layer will look like. You can provide textures for 
// different types of Edges & intersections
generator.AddGidInfo({
	terrainKey : 'layer_plain',
	gidData : {
		enclosing: {
			top: {
				leftValue: 4,
				rightValue: 6,
				topValue: 5
			},
			bottom: {
				leftValue: 18,
				rightValue: 20,
				bottomValue: 19
			},
			left: {
				leftValue: 11
			},
			right: {
				rightValue: 13
			}
		},
		excluding: {
			top: {
				leftValue: 8,
				rightValue: 9,
			},
			bottom: {
				leftValue: 15,
				rightValue: 16,
			}
		},
		other: {
			full: 2,
			closedLoops : {
				openEnds : {
					top : 22,
					right : 23,
					bottom : 24,
					left : 25,
					none : 26,
				},
				twoWay : {
					topBottom : 27,
					leftRight : 28
				}
			},
			openLoops : {
				openEnds : {
					top : 29,
					right : 30,
					bottom : 31,
					left : 32,
					none : 33
				},
				twoWay : {
					topBottom : 34,
					leftRight : 35
				}
			}
		}
	}	
});


generator.AddGidInfo({
	terrainKey : 'layer_snow',
	gidData : {
		enclosing: {
			top: {
				leftValue: 46,
				rightValue: 48,
				topValue: 47
			},
			bottom: {
				leftValue: 60,
				rightValue: 62,
				bottomValue: 61
			},
			left: {
				leftValue: 53
			},
			right: {
				rightValue: 55
			}
		},
		excluding: {
			top: {
				leftValue: 50,
				rightValue: 51,
			},
			bottom: {
				leftValue: 57,
				rightValue: 58,
			}
		},
		other: {
			full: 44,
			closedLoops : {
				openEnds : {
					top : 64,
					right : 65,
					bottom : 66,
					left : 67,
					none : 68,
				},
				twoWay : {
					topBottom : 69,
					leftRight : 70
				}
			},
			openLoops : {
				openEnds : {
					top : 71,
					right : 72,
					bottom : 73,
					left : 74,
					none : 75
				},
				twoWay : {
					topBottom : 76,
					leftRight : 77
				}
			}
		}
	}	
});


/**
 * GID Info for Decoration Layers
 * Not Yet Active
 */
// generator.AddGidInfo({
// 	terrainKey : 'layer_trees',
// 	gidData : {
// 		optionalPercent: 35,
// 		other : [
// 			{
// 				key: "orchid_tree",
// 				value: 77,
// 				weight: 1000
// 			},
// 			{
// 				key: "apple_tree",
// 				value: 78,
// 				weight: 1
// 			},
// 			{
// 				key: "pear_tree",
// 				value: 79,
// 				weight: 1
// 			}
// 		]	
// 	}
// });

//
// This is Important for Layer Hierarchy
// Larger the Index the more Dominant it is.
// Just make sure that The layer you want to stay at the top most, stays at the end of this Array
//
generator.AddLayerDomination({
	dominationPriority: ['layer_water', 'layer_plain', 'layer_snow']
});

// Tileset Information for the Tiled Map
generator.AddTileset({
	source: 'origin_tileset_3_layers.png',
	height:160,
	width:224,
	tileWidth:32,
	tileHeight:32
});

// For Generating Only 2D Array of Values:
// generator.GenerateMapValues();
// var map = generator.GetMapValues();

// Full Generation - Map Array -> 3D Layer -> TMX Map
// Use this If you want full generation from Scratch without any Custom Breakpoints 
// between the Generation Process
generator.GenerateMap();

// For Displaying Map: (Array Values)
generator.RenderMapValues('map-container');

// For Getting Final TMX Map
var TMX_XML = generator.GetTmxXml();
console.log(TMX_XML);




function updateFunction(progressValue) {
	console.log("Got Some Progress Value from Lib : " + progressValue);
}
</script>
<style>
* {
	box-sizing:content-box;
	margin: 0;
	padding: 0;
}

#map-container {
	margin: 10px;
	display: inline-block;
/*	border-top: solid 1px #777;
	border-left: solid 1px #777;*/
}

.cell {
	display: inline-block;
	min-height: 30px;
	min-width: 30px;
	height: 30px;
	width: 30px;
	line-height: 30px;
	text-align: center;
	float: left;
	background: #777;
/*	border-bottom: solid 1px #777;
	border-right: solid 1px #777;*/
	overflow: hidden;
}

.cell.no-cell {
	background: #777;
}

.cell.layer_plain {
	background: #12A637;
}

.cell.layer_hill {
	background: #BF4936;
}

.cell.layer_water {
	background: #296CF2;
}

.cell.layer_snow {
	background: #00701C;
}

.row {
	display: flex;
	flex-direction:row;
}
</style>