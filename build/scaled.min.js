function GenerateRow(a){var b="<div class='row'>";for(var c in a)b+=GenerateCell(a[c]);return b+="</div>"}function GenerateCell(a){var b="";return b+="<div class='cell'>",b+=a,b+="</div>"}var Commons={},PLUS_MINUS_BAR=4;Commons.RoundNumber=function(a){return Math.round(a)},Commons.Randomize=function(a,b){return Math.floor(Math.random()*(b+1)+a)},Commons.RandomizeInArray=function(a){var b=0,c=a.length-1,d=this.Randomize(b,c);return a[d]},Commons.RandomizeWithException=function(a,b,c){var d=-1;do d=this.Randomize(a,b);while(-1!=c.indexOf(d));return d},Commons.RandomizePlusMinus=function(a,b){{var c=this.Randomize(1,10);this.Randomize(a,b)}return PLUS_MINUS_BAR>=c?-1*c:c};var ScaledMap=function(){this.terrains=[],this.mapValues=[],this.rowSize=33,this.columnSize=33,this.mapInitValue=-1,this.hasDefaultTerrain=!1,this.startValues=[-1,-1,-1,-1],this.startValuesTerrainKey=["","","",""],this.GetDefaultTerrain=function(){for(var a in this.terrains)if(this.terrains[a].terrainDefault===!0)return this.terrains[a]},this.GetMainTerrains=function(){var a=[];for(var b in this.terrains)"terrain"==this.terrains[b].terrainType&&a.push(this.terrains[b]);return a},this.GetTerrainByKey=function(a){for(var b in this.terrains)if(this.terrains[b].terrainKey==a)return this.terrains[b]},this.GetTerrainById=function(a){for(var b in this.terrains)if(this.terrains[b].terrainId==a)return this.terrains[b]}};ScaledMap.prototype.SetDimensions=function(a,b){this.rowSize=a,this.columnSize=b},ScaledMap.prototype.AddTerrain=function(a){var b=this.terrains.length,c=new ScaledTerrain;"zLevel"in a?c.CreateTerrain(b,a.label,a.key,a.max,a.min,a.zLevel):c.CreateTerrain(b,a.label,a.key,a.max,a.min,0),"type"in a&&c.SetType(a.type),"default"in a&&this.hasDefaultTerrain===!1&&(this.hasDefaultTerrain=!0,c.SetDefault()),this.terrains.push(c)},ScaledMap.prototype.AddStartingCondition=function(a){var b=this.GetTerrainByKey(a.layerKey);b.terrainStartCount=a.minCount,b.terrainStartPercent=a.optionalPercent},ScaledMap.prototype.Init=function(){for(this.hasDefaultTerrain===!1&&terrains[0].SetDefault(),i=0;i<this.rowSize;i++){var a=[];for(j=0;j<this.columnSize;j++)a.push(this.mapInitValue);this.mapValues.push(a)}var b=[],c=0,d=this.GetMainTerrains();for(var e in d)if(d[e].terrainStartCount>0){var f={};f.id=d[e].terrainId,f.count=d[e].terrainStartCount,f.nextPercent=d[e].terrainStartPercent,c+=d[e].terrainStartCount,b.push(f)}b.sort(function(a,b){return b.count-a.count});var g=4,h=[];if(4>=c){g=4-c;for(var k in b)for(j=0;j<b[k].count;j++){var l=Commons.RandomizeWithException(0,3,h);h.push(l),this.startValues[l]=b[k].id}}if(0!==g){var m=0,n=[],o=[];for(var p in d){var q={};d[p].terrainStartPercent>0?(m+=d[p].terrainStartPercent,q.terrainId=d[p].terrainId,q.cumulativePercent=m,n.push(q)):(q.terrainId=d[p].terrainId,o.push(q))}if(m>100);else for(i=0;i<g;i++){var r=Commons.RandomizeWithException(0,3,h);h.push(r);var s=Commons.Randomize(0,100),t=null,u=!1;for(var v in n)if(s<=n[v].cumulativePercent){u=!0,t=n[v].terrainId;break}u===!1&&(t=Commons.RandomizeInArray(o).terrainId),this.startValues[r]=t}}},ScaledMap.prototype.GenerateMapValues=function(){this.Init()};var diamondStep=function(a,b,c,d){},squareStep=function(a,b,c,d){},ScaledTerrain=function(){this.terrainUpperValue=-1,this.terrainLowerValue=-1,this.terrainLabel=-1,this.terrainKey=-1,this.terrainId=-1,this.terrainZLevel=-1,this.terrainType="terrain",this.terrainDefault=!1,this.terrainStartCount=0,this.terrainStartPercent=0};ScaledTerrain.prototype.CreateTerrain=function(a,b,c,d,e,f){this.terrainUpperValue=d,this.terrainLowerValue=e,this.terrainKey=c,this.terrainLabel=b,this.terrainId=a,this.terrainZLevel=f},ScaledTerrain.prototype.SetStartingCondition=function(a,b){this.terrainStartPercent=b,this.terrainStartCount=a},ScaledTerrain.prototype.SetDefault=function(){this.terrainDefault=!0},ScaledTerrain.prototype.SetType=function(a){this.terrainType=a};var ScaledGen=function(){this.mainMap=new ScaledMap};ScaledGen.prototype.SetMapSize=function(a,b){this.mainMap.rowSize=a,this.mainMap.columnSize=b},ScaledGen.prototype.AddTerrain=function(a){this.mainMap.AddTerrain(a)},ScaledGen.prototype.AddStartingCondition=function(a){this.mainMap.AddStartingCondition(a)},ScaledGen.prototype.GenerateMap=function(){this.mainMap.GenerateMapValues()},ScaledGen.prototype.RenderMapValues=function(a){var b=document.getElementById(a),c=this.mainMap.mapValues,d="";for(var e in c)d+=GenerateRow(c[e]);b.innerHTML=d};